{% extends 'base.html' %}

{% block title %}Manage Grievance #{{ grievance.id }} - Grievance System{% endblock %}

{% block content %}
<div class="card" style="max-width: 800px; margin: 30px auto;">
    <h2>Manage Grievance #{{ grievance.id }}</h2>
    
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <p><strong>Student:</strong> {{ grievance.student_name }} (ID: {{ grievance.student_id }})</p>
        <p><strong>Category:</strong> {{ grievance.category }}</p>
        <p><strong>Current Status:</strong> 
            <span class="status status-{{ grievance.status|lower|replace(' ', '-') }}">
                {{ grievance.status }}
            </span>
        </p>
        <p><strong>Submitted On:</strong> {{ grievance.created_at }}</p>
        {% if grievance.updated_at %}
        <p><strong>Last Updated:</strong> {{ grievance.updated_at }}</p>
        {% endif %}
    </div>
    
    <div style="margin-bottom: 20px;">
        <h3 style="color: #333; margin-bottom: 10px;">Description</h3>
        <div style="background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 5px; white-space: pre-wrap;">{{ grievance.description }}</div>
    </div>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <!-- Update Status -->
        <div style="background: #f0f0f0; padding: 20px; border-radius: 8px; border: 1px solid #ccc;">
            <h3 style="color: #333; margin-bottom: 15px;">Update Status</h3>
            <form method="POST">
                <input type="hidden" name="action" value="update_status">
                <div class="form-group">
                    <select name="status" required>
                        {% for s in statuses %}
                        <option value="{{ s }}" {% if grievance.status == s %}selected{% endif %}>{{ s }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Update Status</button>
            </form>
        </div>
        
        <!-- Delete -->
        <div style="background: #e8e8e8; padding: 20px; border-radius: 8px; border: 1px solid #999;">
            <h3 style="color: #333; margin-bottom: 15px;">Danger Zone</h3>
            <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">This action cannot be undone.</p>
            <form method="POST" onsubmit="return confirm('Are you sure you want to delete this grievance?');">
                <input type="hidden" name="action" value="delete">
                <button type="submit" class="btn btn-danger">Delete Grievance</button>
            </form>
        </div>
    </div>
    
    <!-- Add Response -->
    <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ccc;">
        <h3 style="color: #333; margin-bottom: 15px;">Admin Response</h3>
        <form method="POST">
            <input type="hidden" name="action" value="add_response">
            <div class="form-group">
                <textarea name="response" rows="4" placeholder="Enter your response to the student..." required>{{ grievance.response }}</textarea>
            </div>
            <button type="submit" class="btn btn-success">Save Response</button>
        </form>
    </div>
    
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
</div>
{% endblock %}
